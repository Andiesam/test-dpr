name: Test Webhook
on:
  workflow_dispatch:
  
jobs:
  prereq-job-1:
    name: Prerequisites 1
    runs-on: ubuntu-latest
    steps:
      - name: Setup Task
        run: |
          echo "ğŸ”§ Running prerequisite task 1..."
          sleep 2
          echo "âœ… Prerequisite 1 completed"

  prereq-job-2:
    name: Prerequisites 2  
    runs-on: ubuntu-latest
    steps:
      - name: Build Task
        run: |
          echo "ğŸ”¨ Running build task..."
          sleep 3
          echo "âœ… Build completed"

  before-protection:
    name: Before Protection
    runs-on: ubuntu-latest
    needs: [prereq-job-1, prereq-job-2]
    steps:
      - name: Pre-deployment checks
        run: |
          echo "ğŸ” Running pre-deployment checks..."
          echo "All prerequisites completed"
          echo "Ready for protected deployment"
          echo "âœ… Pre-deployment checks passed"

  protected-deployment:
    name: ğŸ›¡ï¸ PROTECTED DEPLOYMENT
    runs-on: ubuntu-latest
    needs: before-protection
    environment: test-dpr
    steps:
      - name: Protected Deploy Step
        run: |
          echo "ğŸš€ PROTECTED DEPLOYMENT STARTED"
          echo "Run ID: ${{ github.run_id }}"
          echo "Repository: ${{ github.repository }}"
          echo "Environment: test-dpr"
          echo "âš ï¸  IF YOU SEE THIS, THE PROTECTION WAS BYPASSED OR APPROVED!"
          echo "Current time: $(date)"
          
      - name: Simulate Deployment
        run: |
          echo "ğŸ“¦ Deploying application..."
          sleep 5
          echo "âœ… Application deployed successfully"

  post-deployment-1:
    name: Post Deploy Tasks 1
    runs-on: ubuntu-latest
    needs: protected-deployment
    steps:
      - name: Notifications
        run: |
          echo "ğŸ“§ Sending deployment notifications..."
          echo "âœ… Notifications sent"

  post-deployment-2:
    name: Post Deploy Tasks 2
    runs-on: ubuntu-latest  
    needs: protected-deployment
    steps:
      - name: Cleanup
        run: |
          echo "ğŸ§¹ Running cleanup tasks..."
          echo "âœ… Cleanup completed"

  final-step:
    name: Pipeline Complete
    runs-on: ubuntu-latest
    needs: [post-deployment-1, post-deployment-2]
    steps:
      - name: Final Status
        run: |
          echo "ğŸ‰ ENTIRE PIPELINE COMPLETED!"
          echo "All jobs executed successfully"
          echo "Protection rule worked correctly"
